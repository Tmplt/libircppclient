language: cpp

compiler:
  - gcc
  - clang

# Currently, clang is updated on both builds, which shouldn't be the case.
# Fix this so that it only updates when clang is going to be used.
before_install:
#  - ./util/check_tabs.sh
  - uname -a                                                  # Ubuntu Precise
  - sudo add-apt-repository --yes ppa:sfttech/random          # CMake
  - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test # GCC toolchain with C++14 support, also needed for the llvm deb.
  - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key|sudo apt-key add -
  - sudo add-apt-repository --yes 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' # Clang toolchain with C++14 support.
  - sudo apt-get update -qq

install:
  # Update Ubuntu's outdated toolchains.
  - export CVERSION="4.9"
  - export CLANG_VERSION="3.8"
  - export PROJECT_DIR=`pwd`
  - export BOOST_VERSION="1.60.0"

  # Install and export updated toolchains.
  ## GNU
  - sudo apt-get install -qq g++-${CVERSION}
  - if [ "$CXX" = "g++" ]; then export CXX="g++-${CVERSION}" CC="gcc-${CVERSION}"; fi
  - export  CC=`which $CC`
  - export CXX=`which $CXX`

  ## Clang
  - sudo apt-get install clang-${CLANG_VERSION}
  - export  CC=`which clang-${CLANG_VERSION}`
  - export CXX=`which clang++-${CLANG_VERSION}`

  # Get the latest version of Boost, and compile it
  - ./util/travis/install_boost.sh

  - sudo apt-get remove -qq cmake            # remove the museum edition (according to github.com/SFTtech/openage)
  - sudo apt-get install -qq cmake clang
  - sudo apt-get install apt-show-versions

before_script:
  - clang --version
  - gcc   --version
  - cmake --version

script:
  - mkdir -p travisbuild
  - cd travisbuild
  - cmake ..
  - make

notifications:
  email: false
